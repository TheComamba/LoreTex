
\begin{luacode*}
dofile("../shared/luatex-for-dnd/entities.lua")
\end{luacode*}

\newcommand{\setContinent}[1]{\directlua{CurrentContinent = "#1"}}
\newcommand{\setRegion}[1]{\directlua{CurrentRegion = "#1"}}
\newcommand{\setCity}[1]{\directlua{CurrentCity = "#1"}}

\newcommand{\newEntity}[4]{
	\directlua{CurrentLabel = "#1"}
	\directlua{AddDescriptor(CurrentLabel,"type","#2")}
	\directlua{AddDescriptor(CurrentLabel,"shortname", "#3")}
	\directlua{AddDescriptor(CurrentLabel,"name", "#4")}
}

\newcommand{\newNPC}[3]{
	\newEntity{#1}{npc}{#2}{#3}
	\directlua{SetLocation(CurrentLabel)}
}

\newcommand{\newContinent}[3]{
	\newEntity{#1}{continent}{#2}{#3}
	\setContinent{#1}
}

\newcommand{\newRegion}[3]{
	\newEntity{#1}{region}{#2}{#3}
	\directlua{AddDescriptor(CurrentLabel,"parent", CurrentContinent)}
	\setRegion{#1}
}

\newcommand{\newCity}[3]{
	\newEntity{#1}{city}{#2}{#3}
	\directlua{AddDescriptor(CurrentLabel,"parent", CurrentRegion)}
	\setCity{#1}
}

\newcommand{\addDescriptor}[2]{
	\directlua{
		AddDescriptor(CurrentLabel,[[#1]],[[\detokenize{#2}]])
	}
}

\newcommand{\automatedChapters}{
	\input{../shared/npcs/all.tex}
	\input{../shared/geography/all.tex}
	\directlua{AutomatedChapters()}
}

\newcommand{\automatedChaptersFUCKINGEVERYTHING}{
	\input{../shared/npcs/all.tex}
	\input{../shared/geography/all.tex}
	\directlua{AddAllRefsToPrimary()}
	\directlua{AutomatedChapters()}
}

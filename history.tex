
\begin{luacode*}
	dofile(RelativePath .. "history.lua")
\end{luacode*}

\newcommand{\addHistory}[3][0]{
	\directlua{
		if true then
			local item = EmptyHistoryItem()
			item["originator"] = GetMainLabel(CurrentEntity())
			SetDay(item, "#1")
			SetYear(item, "#2")
			item["event"] = [[\detokenize{#3}]]
			ProcessEvent(item)
		end
	}
}
\newcommand{\addSecretHistory}[3][0]{
	\directlua{
		if true then
			local item = EmptyHistoryItem()
			item["originator"] = GetMainLabel(CurrentEntity())
			SetDay(item, "#1")
			SetYear(item, "#2")
			item["event"] = [[\detokenize{#3}]]
			item["isSecret"] = true
			ProcessEvent(item)
		end
	}
}
\newcommand{\addHistoryOnlyHere}[3][0]{
	\directlua{
		if true then
			local item = EmptyHistoryItem()
			item["originator"] = GetMainLabel(CurrentEntity())
			SetDay(item, "#1")
			SetYear(item, "#2")
			item["event"] = [[\detokenize{#3}]]
			item["isConcernsOthers"] = false
			ProcessEvent(item)
		end
	}
}
\newcommand{\addHistoryInFmt}[4][0]{
	\directlua{
		if true then
			local item = EmptyHistoryItem()
			item["originator"] = GetMainLabel(CurrentEntity())
			SetDay(item, "#1")
			SetYearFmt(item, #2)
			SetYear(item, "#3")
			item["event"] = [[\detokenize{#4}]]
			ProcessEvent(item)
		end
	}
}
\newcommand{\addSecretHistoryInFmt}[4][0]{
	\directlua{
		if true then
			local item = EmptyHistoryItem()
			item["originator"] = GetMainLabel(CurrentEntity())
			SetDay(item, "#1")
			SetYearFmt(item, #2)
			SetYear(item, "#3")
			item["event"] = [[\detokenize{#4}]]
			item["isSecret"] = true
			ProcessEvent(item)
		end
	}
}
\newcommand{\addHistoryInFmtOnlyHere}[4][0]{
	\directlua{
		if true then
			local item = EmptyHistoryItem()
			item["originator"] = GetMainLabel(CurrentEntity())
			SetDay(item, "#1")
			SetYearFmt(item, #2)
			SetYear(item, "#3")
			item["event"] = [[\detokenize{#4}]]
			item["isConcernsOthers"] = false
			ProcessEvent(item)
		end
	}
}

\newcommand{\setPrintHistoryYear}[1]{\directlua{PrintHistoryYear = #1}}
\newcommand{\setPrintHistoryDay}[1]{\directlua{PrintHistoryDay = #1}}
\newcommand{\printHistory}[1]{#1\directlua{AddEvent(nil, PrintHistoryYear, [[\detokenize{#1}]], PrintHistoryDay)}}
\newcommand{\printSecretHistory}[1]{\mybox{#1}\directlua{AddEvent(nil, PrintHistoryYear, [[\detokenize{#1}]], PrintHistoryDay, true)}}


\newcommand{\concerns}[1]{}
\newcommand{\notconcerns}[1]{}
\newcommand{\birthof}[1]{}
\newcommand{\deathof}[1]{}

\newcommand{\born}[3][0]{
	\addHistory[#1]{#2}{#3}
	\directlua{CurrentEntity()["born"] = #2}
}
\newcommand{\died}[3][0]{
	\addHistory[#1]{#2}{#3}
	\directlua{CurrentEntity()["died"] = #2}
}
\newcommand{\bornInFmt}[4][0]{
	\addHistoryInFmt[#1]{#2}{#3}{#4}
	\directlua{CurrentEntity()["born"] = ConvertYearToVin(#3, #2)}
}
\newcommand{\diedInFmt}[4][0]{
	\addHistoryInFmt[#1]{#2}{#3}{#4}
	\directlua{CurrentEntity()["died"] = ConvertYearToVin(#3, #2)}
}
